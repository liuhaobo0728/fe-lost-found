{"remainingRequest":"/Users/liuhaobo/Desktop/fe-lost-found/node_modules/babel-loader/lib/index.js!/Users/liuhaobo/Desktop/fe-lost-found/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/liuhaobo/Desktop/fe-lost-found/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liuhaobo/Desktop/fe-lost-found/src/components/upload/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liuhaobo/Desktop/fe-lost-found/src/components/upload/index.vue","mtime":1553420104684},{"path":"/Users/liuhaobo/Desktop/fe-lost-found/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuhaobo/Desktop/fe-lost-found/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/liuhaobo/Desktop/fe-lost-found/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuhaobo/Desktop/fe-lost-found/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nexport default {\n  name: 'upload',\n  data: function data() {\n    return {\n      avatar: '',\n      file: '',\n      showBg: false\n    };\n  },\n  props: [\"uploadType\", \"imgUrl\", \"imgWidth\", \"imgHeight\"],\n  created: function created() {\n    this.avatar = this.imgUrl;\n  },\n  methods: {\n    changeImage: function changeImage(e) {\n      console.log(e);\n      var file = e.target.files[0];\n\n      if (file) {\n        this.file = file;\n        console.log(this.file);\n        var reader = new FileReader();\n        var that = this;\n        reader.readAsDataURL(file);\n\n        reader.onload = function (e) {\n          // 这里的this 指向reader\n          that.avatar = this.result;\n        };\n      }\n    },\n    upload: function upload() {\n      var _this = this;\n\n      var files = this.$refs.avatarInput.files;\n      var fileData = {};\n\n      if (files instanceof Array) {\n        fileData = files[0];\n      } else {\n        fileData = this.file;\n      } // console.log('fileData', typeof fileData, fileData)\n\n\n      var data = new FormData();\n      data.append('multfile', fileData);\n      data.append('operaType', this.uploadType);\n      this.$store.dispatch('UPLOAD_HEAD', data).then(function (res) {\n        console.log(res);\n        _this.file = '';\n        var data = res.data.data;\n\n        _this.$emit(\"upload\", data);\n\n        _this.$message({\n          type: \"success\",\n          message: \"上传成功！\"\n        });\n      }).catch(function (err) {\n        console.log(err);\n\n        if (err.data.msg) {\n          _this.$message({\n            type: \"error\",\n            message: err.data.msg\n          });\n        } else {\n          _this.$message({\n            type: \"error\",\n            message: \"上传失败\"\n          });\n        }\n      });\n    }\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;AAaA,eAAA;AACA,EAAA,IAAA,EAAA,QADA;AAEA,EAAA,IAFA,kBAEA;AACA,WAAA;AACA,MAAA,MAAA,EAAA,EADA;AAEA,MAAA,IAAA,EAAA,EAFA;AAGA,MAAA,MAAA,EAAA;AAHA,KAAA;AAKA,GARA;AASA,EAAA,KAAA,EAAA,CAAA,YAAA,EAAA,QAAA,EAAA,UAAA,EAAA,WAAA,CATA;AAUA,EAAA,OAVA,qBAUA;AACA,SAAA,MAAA,GAAA,KAAA,MAAA;AACA,GAZA;AAaA,EAAA,OAAA,EAAA;AACA,IAAA,WAAA,EAAA,qBAAA,CAAA,EAAA;AACA,MAAA,OAAA,CAAA,GAAA,CAAA,CAAA;AACA,UAAA,IAAA,GAAA,CAAA,CAAA,MAAA,CAAA,KAAA,CAAA,CAAA,CAAA;;AACA,UAAA,IAAA,EAAA;AACA,aAAA,IAAA,GAAA,IAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,KAAA,IAAA;AACA,YAAA,MAAA,GAAA,IAAA,UAAA,EAAA;AACA,YAAA,IAAA,GAAA,IAAA;AACA,QAAA,MAAA,CAAA,aAAA,CAAA,IAAA;;AACA,QAAA,MAAA,CAAA,MAAA,GAAA,UAAA,CAAA,EAAA;AACA;AACA,UAAA,IAAA,CAAA,MAAA,GAAA,KAAA,MAAA;AACA,SAHA;AAIA;AACA,KAfA;AAgBA,IAAA,MAAA,EAAA,kBAAA;AAAA;;AACA,UAAA,KAAA,GAAA,KAAA,KAAA,CAAA,WAAA,CAAA,KAAA;AACA,UAAA,QAAA,GAAA,EAAA;;AACA,UAAA,KAAA,YAAA,KAAA,EAAA;AACA,QAAA,QAAA,GAAA,KAAA,CAAA,CAAA,CAAA;AACA,OAFA,MAEA;AACA,QAAA,QAAA,GAAA,KAAA,IAAA;AACA,OAPA,CAQA;;;AACA,UAAA,IAAA,GAAA,IAAA,QAAA,EAAA;AACA,MAAA,IAAA,CAAA,MAAA,CAAA,UAAA,EAAA,QAAA;AACA,MAAA,IAAA,CAAA,MAAA,CAAA,WAAA,EAAA,KAAA,UAAA;AACA,WAAA,MAAA,CAAA,QAAA,CAAA,aAAA,EAAA,IAAA,EACA,IADA,CACA,UAAA,GAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,GAAA;AACA,QAAA,KAAA,CAAA,IAAA,GAAA,EAAA;AACA,YAAA,IAAA,GAAA,GAAA,CAAA,IAAA,CAAA,IAAA;;AACA,QAAA,KAAA,CAAA,KAAA,CAAA,QAAA,EAAA,IAAA;;AACA,QAAA,KAAA,CAAA,QAAA,CAAA;AACA,UAAA,IAAA,EAAA,SADA;AAEA,UAAA,OAAA,EAAA;AAFA,SAAA;AAIA,OAVA,EAUA,KAVA,CAUA,UAAA,GAAA,EAAA;AACA,QAAA,OAAA,CAAA,GAAA,CAAA,GAAA;;AACA,YAAA,GAAA,CAAA,IAAA,CAAA,GAAA,EAAA;AACA,UAAA,KAAA,CAAA,QAAA,CAAA;AACA,YAAA,IAAA,EAAA,OADA;AAEA,YAAA,OAAA,EAAA,GAAA,CAAA,IAAA,CAAA;AAFA,WAAA;AAIA,SALA,MAKA;AACA,UAAA,KAAA,CAAA,QAAA,CAAA;AACA,YAAA,IAAA,EAAA,OADA;AAEA,YAAA,OAAA,EAAA;AAFA,WAAA;AAIA;AACA,OAvBA;AAwBA;AApDA;AAbA,CAAA","sourcesContent":["\n<template>\n    <div class=\"avatar\">\n        <div >\n            <div class=\"bg\" :style=\"`line-height:${imgHeight}`\">点击上传</div>\n            <input type=\"file\" class=\"input-file\" :style=\"`width:${imgWidth};height:${imgHeight};`\" name=\"avatar\" ref=\"avatarInput\" @change=\"changeImage($event)\" accept=\"image/gif,image/jpeg,image/jpg,image/png\">\n            <img src=\"\" alt=\"\" :style=\"`width:${imgWidth};height: ${imgHeight};`\" name=\"avatar\">\n        </div>\n        <div class=\"text\" @click=\"upload\" v-if=\"file\">确定上传</div>\n    </div>\n</template>\n\n<script>\nexport default {\n    name: 'upload',\n    data(){\n        return{\n            avatar: '',\n            file: '',\n            showBg: false\n        }\n    },\n    props: [\"uploadType\", \"imgUrl\", \"imgWidth\", \"imgHeight\"],\n    created(){\n        this.avatar = this.imgUrl\n    },\n    methods: {\n        changeImage: function(e){\n            console.log(e)\n            let file = e.target.files[0];\n            if(file) {\n                this.file = file\n                console.log(this.file)\n                let reader = new FileReader()\n                let that = this\n                reader.readAsDataURL(file)\n                reader.onload= function(e){\n                    // 这里的this 指向reader\n                    that.avatar = this.result\n                }\n            }\n        },\n       upload: function(){\n          let files = this.$refs.avatarInput.files\n          let fileData = {}\n          if(files instanceof Array) {\n            fileData = files[0]\n          } else {\n            fileData = this.file\n          }\n          // console.log('fileData', typeof fileData, fileData)\n          let data = new FormData()\n          data.append('multfile', fileData)\n          data.append('operaType', this.uploadType)\n          this.$store.dispatch('UPLOAD_HEAD', data)\n          .then(res => {\n            console.log(res)\n            this.file = '';\n            let data = res.data.data;\n            this.$emit(\"upload\", data );\n              this.$message({\n                type: \"success\",\n                message: \"上传成功！\"\n              })\n          }).catch(err => {\n            console.log(err)\n            if(err.data.msg){\n              this.$message({\n                type: \"error\",\n                message: err.data.msg\n              })\n            }else {\n              this.$message({\n                type: \"error\",\n                message: \"上传失败\"\n              })\n            }\n          })\n        }\n    }\n}\n</script>\n\n\n<style lang=\"scss\" scope>\n.avatar {\n    cursor: pointer;\n    position: relative;\n    .input-file {\n        position: absolute;\n        top: 0;\n        left: 0;\n        opacity: 0;\n        cursor: pointer;\n    }\n    .bg {\n        width: 100%;\n        height: 100%;\n        color: #000;\n        text-align: center;\n        background-color: #fff;\n        border: 1px dashed #000;\n        cursor: pointer;\n        position: absolute;\n        top: 0;\n        left: 0;\n \n    }\n    .text {\n        padding-top: 10px;\n        color: #000;\n    }\n}\n</style>"],"sourceRoot":"src/components/upload"}]}